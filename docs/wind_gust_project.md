# üå¨Ô∏è Wind Module Gust Enhancement Project
**Ut√∂ka Wind Module med vindbyar-st√∂d f√∂r dubbel trigger-logik och f√∂rb√§ttrad visning**

## üéØ Projektm√•l

**HUVUDM√ÖL**: Ut√∂ka befintlig Wind Module att st√∂dja b√•de medelvind OCH vindbyar f√∂r trigger-aktivering och visning.

**SPECIFIKA M√ÖL**:
1. ‚úÖ **Dubbel trigger-logik**: Aktivera wind-modul om ANTINGEN medelvind ELLER vindbyar √∂verstiger tr√∂skelv√§rde
2. ‚úÖ **F√∂rb√§ttrad visning**: "10 m/s (15)" format d√§r (15) √§r byv√§rdet  
3. ‚úÖ **Bak√•tkompatibilitet**: Befintlig konfiguration ska forts√§tta fungera
4. ‚úÖ **Robust fallback**: Graceful degradation om vindbyar-data saknas
5. ‚úÖ **Test-system**: Komplett testning av ny funktionalitet

## üö´ ANTI-MONOLIT Constraint Check

**‚úÖ GODK√ÑNT PROJEKT**: 
- **Begr√§nsad scope**: Endast Wind Module och related triggers
- **Modul√§r approach**: Separata √§ndringar i WeatherClient, TriggerEvaluator, WindRenderer
- **Max 200 rader per fil**: Inga filer kommer √∂verstiga gr√§nsen
- **Single Responsibility**: Varje √§ndring har ett tydligt ansvar

**ARKITEKTUR-CHECKPOINT vid 100 rader kod**: Utv√§rdera om uppdelning beh√∂vs

## üìã F√∂ruts√§ttningar och Kunskapsluckor

### ‚úÖ K√ÑNT (fr√•n befintlig kod):
- Wind Module anv√§nder SMHI parametrar `ws` (vindstyrka) och `wd` (vindriktning)  
- Trigger-system finns i `main_daemon.py` med condition evaluation
- WindRenderer finns i `modules/renderers/wind_renderer.py`
- WeatherClient hanterar SMHI API-anrop i `modules/weather_client.py`

### ‚ùì KUNSKAPSLUCKOR (kr√§ver research):
1. **KRITISK**: Vilka SMHI-parametrar finns f√∂r vindbyar/gusts?
   - M√∂jliga namn: `gust`, `wind_gust`, `wg`, `maximum_wind_gust`?
   - Finns detta i prognoser-API:et eller bara observations?
   - Samma tidsuppl√∂sning som `ws`?

2. **VIKTIGT**: SMHI API-struktur f√∂r vindbyar
   - JSON-format f√∂r gust-data
   - Kvalitetskoder och tillg√§nglighet
   - Fallback-strategier vid saknad data

3. **NICE-TO-HAVE**: Meteorologisk praxis
   - Hur l√§nge m√§ts vindbyar? (3-sekunder som n√§mns i docs?)
   - Relation mellan medelvind och byar (typiska ratios)

### üîç RESEARCH TASKS (beh√∂ver g√∂ras f√∂rst):
```bash
# Task 1: Identifiera SMHI gust-parametrar
python3 -c "
import requests
url = 'https://opendata-download-metfcst.smhi.se/api/category/pmp3g/version/2/geotype/point/lon/18.0686/lat/59.3293/data.json'
resp = requests.get(url)
data = resp.json()
params = set()
for ts in data['timeSeries'][:3]:
    for p in ts['parameters']:
        params.add(p['name'])
print('Tillg√§ngliga parametrar:', sorted(params))
print('S√∂k efter: gust, wind, wg, maxwind')
"

# Task 2: Unders√∂k SMHI observations f√∂r vindbyar
# Kontrollera om vindbyar finns i observations-API:et

# Task 3: Validera befintlig trigger-syntax
# S√§kerst√§ll att nya conditions fungerar med befintlig parser
```

## üèóÔ∏è Teknisk Arkitektur

### üìÅ Filer som kommer √§ndras:
```
modules/weather_client.py          # API-integration f√∂r gust-data
modules/renderers/wind_renderer.py # Visning av "speed (gust)" format  
main_daemon.py                     # Trigger evaluation f√∂r gust conditions
config.json                        # Nya trigger-conditions och konfiguration
tools/test_wind_gust_trigger.py    # NYTT: Test-system f√∂r gust triggers
```

### üîÑ Data Flow:
```
1. WeatherClient.parse_smhi_forecast() 
   ‚Üí Extrahera b√•de 'ws' OCH gust-parameter
   
2. WeatherClient.combine_weather_data()
   ‚Üí Kombinera wind_speed + wind_gust i samma struktur
   
3. TriggerEvaluator (main_daemon.py)
   ‚Üí Utv√§rdera: "wind_speed > 8 OR wind_gust > 8"
   
4. WindRenderer.render()
   ‚Üí Visa: "10.2 m/s (14.5)" format med b√•da v√§rdena
```

## üìä Implementation Plan

### **STEG 1: Research och API-discovery** ‚è±Ô∏è 30 min
**M√ÖL**: Identifiera exakta SMHI-parametrar f√∂r vindbyar

**ACTIONS**:
```bash
# 1.1 Unders√∂k tillg√§ngliga SMHI-parametrar  
python3 research_smhi_gust_params.py

# 1.2 Testa API-responses f√∂r gust-data
curl "https://opendata-download-metfcst.smhi.se/api/category/pmp3g/version/2/geotype/point/lon/18.0686/lat/59.3293/data.json" | jq '.timeSeries[0].parameters[] | select(.name | contains("gust") or contains("wind") or contains("wg"))'

# 1.3 Dokumentera findings
echo "Gust parameter: [DISCOVERED_NAME]" >> gust_research.md
```

**DELIVERABLE**: `gust_research.md` med exakta parameter-namn och API-struktur

**BACKUP**: Innan research
```bash
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="backup/ORIGINAL_gust_research_$TIMESTAMP"
mkdir -p "$BACKUP_DIR"
echo "Starting gust research" > "$BACKUP_DIR/README_backup.txt"
```

---

### **STEG 2: WeatherClient ut√∂kning** ‚è±Ô∏è 45 min  
**M√ÖL**: Ut√∂ka `parse_smhi_forecast()` med gust-data extraction

**BACKUP F√ñRE √ÑNDRING**:
```bash
TIMESTAMP=$(date +%Y%m%d_%H%M_S)
BACKUP_DIR="backup/weather_client_gust_$TIMESTAMP"
mkdir -p "$BACKUP_DIR"
cp modules/weather_client.py "$BACKUP_DIR/"
echo "‚úÖ Backup: $BACKUP_DIR/weather_client.py"
```

**CHANGES**:
```python
# I parse_smhi_forecast() metoden, l√§gg till:
elif param['name'] == '[DISCOVERED_GUST_PARAM]':  # Vindbyar
    data['wind_gust'] = param['values'][0]
    
# I combine_weather_data() metoden:
if smhi_data and 'wind_gust' in smhi_data:
    combined['wind_gust'] = smhi_data['wind_gust']
    combined['wind_gust_source'] = 'smhi'
else:
    # Fallback: estimera fr√•n medelvind (gust ‚âà 1.4 √ó medelvind)
    if 'wind_speed' in combined:
        combined['wind_gust'] = round(combined['wind_speed'] * 1.4, 1)
        combined['wind_gust_source'] = 'estimated'
```

**TESTING**:
```bash
# Testa gust-data extraction
python3 -c "
from modules.weather_client import WeatherClient
import json
with open('config.json', 'r') as f: config = json.load(f)
client = WeatherClient(config)
data = client.get_current_weather()
print(f'Wind: {data.get(\"wind_speed\", 0)} m/s')
print(f'Gust: {data.get(\"wind_gust\", \"N/A\")} m/s')
print(f'Gust source: {data.get(\"wind_gust_source\", \"unknown\")}')
"
```

---

### **STEG 3: Trigger-system ut√∂kning** ‚è±Ô∏è 30 min
**M√ÖL**: Ut√∂ka trigger evaluation med `wind_gust` variabel

**BACKUP**:
```bash
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="backup/trigger_gust_$TIMESTAMP"  
mkdir -p "$BACKUP_DIR"
cp main_daemon.py "$BACKUP_DIR/"
cp config.json "$BACKUP_DIR/"
echo "‚úÖ Backup: $BACKUP_DIR/"
```

**CHANGES**:
```python
# I build_trigger_context() (main_daemon.py):
context.update({
    'wind_speed': weather_data.get('wind_speed', 0),
    'wind_gust': weather_data.get('wind_gust', 0),      # NYTT
    'wind_direction': weather_data.get('wind_direction', 0)
})
```

**CONFIG UPDATES**:
```json
{
  "triggers": {
    "wind_trigger": {
      "condition": "wind_speed > 8.0 OR wind_gust > 8.0",
      "target_section": "medium_right_section", 
      "activate_group": "wind_active",
      "priority": 80,
      "description": "Aktivera vid medelvind >8 m/s ELLER vindbyar >8 m/s"
    }
  }
}
```

**TESTING**:
```bash
# Testa trigger evaluation
python3 -c "
import json
from main_daemon import build_trigger_context
with open('config.json', 'r') as f: config = json.load(f)
# Simulera data med gust > threshold men wind_speed < threshold  
weather_data = {'wind_speed': 7.0, 'wind_gust': 10.5}
context = {'wind_speed': 7.0, 'wind_gust': 10.5}
condition = 'wind_speed > 8.0 OR wind_gust > 8.0'
result = eval(condition, {}, context)  # VARNING: Endast f√∂r test
print(f'Trigger result: {result} (ska vara True)')
"
```

---

### **STEG 4: WindRenderer enhancement** ‚è±Ô∏è 40 min
**M√ÖL**: Uppdatera visning till "10 m/s (15)" format

**BACKUP**:
```bash
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="backup/wind_renderer_gust_$TIMESTAMP"
mkdir -p "$BACKUP_DIR"  
cp modules/renderers/wind_renderer.py "$BACKUP_DIR/"
echo "‚úÖ Backup: $BACKUP_DIR/wind_renderer.py"
```

**CHANGES**:
```python
# I WindRenderer.render() metoden:
def format_wind_speed_with_gust(self, wind_speed, wind_gust=None, wind_gust_source=None):
    """Format wind speed with optional gust value"""
    base_speed = f"{wind_speed:.1f} m/s"
    
    if wind_gust and wind_gust > wind_speed:
        if wind_gust_source == 'estimated':
            # Visa estimat diskret
            return f"{base_speed} (~{wind_gust:.0f})"
        else:
            # Visa verklig gust-data
            return f"{base_speed} ({wind_gust:.0f})"
    
    return base_speed

# Anv√§nd i render():
wind_speed = weather_data.get('wind_speed', 0)
wind_gust = weather_data.get('wind_gust')
wind_gust_source = weather_data.get('wind_gust_source')

speed_text = self.format_wind_speed_with_gust(wind_speed, wind_gust, wind_gust_source)
```

**LAYOUT CONSIDERATIONS**:
- Kontrollera att l√§ngre text (15 tecken ist√§llet f√∂r 10) passar i wind-modulen
- Testa radbrytning f√∂r l√•nga texter
- S√§kerst√§ll kollisionsfri layout

---

### **STEG 5: Test-system** ‚è±Ô∏è 35 min
**M√ÖL**: Skapa komplett test-system f√∂r gust-funktionalitet

**NY FIL**: `tools/test_wind_gust_trigger.py`
```python
#!/usr/bin/env python3
"""
S√ÑKER TEST-DATA INJECTION F√ñR WIND GUST MODULE
Testar b√•de medelvind och vindbyar triggers
"""

import json
import time
from pathlib import Path

def create_wind_gust_test_data():
    """Skapa test-data f√∂r gust triggers"""
    test_scenarios = {
        "scenario_1_gust_trigger": {
            "description": "Medelvind under tr√∂skelv√§rde, gust √∂ver",
            "wind_speed": 7.0,    # Under 8.0 tr√∂skelv√§rde
            "wind_gust": 12.5,    # √ñver 8.0 tr√∂skelv√§rde
            "expected_trigger": True
        },
        "scenario_2_both_over": {
            "description": "B√•de medelvind och gust √∂ver tr√∂skelv√§rde", 
            "wind_speed": 10.2,
            "wind_gust": 15.8,
            "expected_trigger": True
        },
        "scenario_3_no_trigger": {
            "description": "B√•de medelvind och gust under tr√∂skelv√§rde",
            "wind_speed": 6.5,
            "wind_gust": 7.8,
            "expected_trigger": False
        }
    }
    
    return test_scenarios

def inject_test_data(scenario_name):
    """Injicera specifikt test-scenario"""
    scenarios = create_wind_gust_test_data()
    
    if scenario_name not in scenarios:
        print(f"‚ùå Ok√§nt scenario: {scenario_name}")
        return
        
    scenario = scenarios[scenario_name]
    
    test_data = {
        "enabled": True,
        "timeout_hours": 1,
        "timestamp": time.time(),
        "scenario": scenario_name,
        "wind_speed": scenario["wind_speed"],
        "wind_gust": scenario["wind_gust"],
        "wind_direction": 225,  # SW f√∂r test
        "description": scenario["description"],
        "expected_trigger": scenario["expected_trigger"]
    }
    
    # Skriv test-data
    test_file = Path("cache/test_wind_gust.json")
    test_file.parent.mkdir(exist_ok=True)
    
    with open(test_file, 'w') as f:
        json.dump(test_data, f, indent=2)
    
    print(f"‚úÖ Injicerat test-scenario: {scenario_name}")
    print(f"üìä Wind: {scenario['wind_speed']} m/s, Gust: {scenario['wind_gust']} m/s")
    print(f"üéØ F√∂rv√§ntat trigger: {scenario['expected_trigger']}")
    
if __name__ == "__main__":
    print("üå¨Ô∏è WIND GUST TRIGGER TEST")
    scenarios = create_wind_gust_test_data()
    
    print("\nTillg√§ngliga test-scenarios:")
    for i, (name, data) in enumerate(scenarios.items(), 1):
        print(f"{i}. {name}: {data['description']}")
    
    choice = input("\nV√§lj scenario (1-3): ")
    scenario_names = list(scenarios.keys())
    
    if choice.isdigit() and 1 <= int(choice) <= len(scenario_names):
        inject_test_data(scenario_names[int(choice)-1])
    else:
        print("‚ùå Ogiltigt val")
```

**TESTING WORKFLOW**:
```bash
# 1. Injicera gust-trigger scenario
python3 tools/test_wind_gust_trigger.py

# 2. Restart daemon f√∂r att ladda test-data  
python3 tools/restart.py

# 3. Kontrollera trigger activation i logs
sudo journalctl -u epaper-weather -f | grep -E "(wind|gust|trigger)"

# 4. Ta screenshot f√∂r visuell verifiering
python3 screenshot.py --output wind_gust_test

# 5. Rensa test-data
rm cache/test_wind_gust.json && python3 tools/restart.py
```

---

### **STEG 6: Konfiguration och dokumentation** ‚è±Ô∏è 20 min
**M√ÖL**: Uppdatera config.json och dokumentation

**CONFIG EXAMPLES**:
```json
{
  "_comment_wind_gust": "=== WIND GUST CONFIGURATION ===",
  "triggers": {
    "wind_trigger": {
      "condition": "wind_speed > 8.0 OR wind_gust > 8.0",
      "description": "Trigger p√• medelvind ELLER vindbyar √∂ver 8 m/s"
    },
    
    "_examples_advanced_gust_triggers": {
      "winter_cycling": {
        "condition": "wind_gust > 12.0 AND temperature < 5.0",
        "description": "Kraftiga vindbyar i kyla - farligt f√∂r cykling"
      },
      "gust_differential": {
        "condition": "(wind_gust - wind_speed) > 5.0",
        "description": "Stora skillnader mellan medelvind och byar"
      }
    }
  },
  
  "wind_gust_config": {
    "show_estimated_gust": true,
    "estimation_factor": 1.4,
    "min_gust_display_threshold": 2.0,
    "gust_display_format": "speed (gust)"
  }
}
```

**DOCUMENTATION UPDATE**:
```markdown
## üå¨Ô∏è Wind Gust Enhancement

### Nya funktioner:
- **Dubbel trigger**: wind_speed > X OR wind_gust > X  
- **Gust visning**: "10.2 m/s (15)" format
- **Fallback**: Estimat om gust-data saknas
- **Test-system**: Komplett gust-scenario testning

### Nya trigger-variabler:
- `wind_gust`: Vindbyar i m/s (fr√•n SMHI eller estimat)
- `wind_gust_source`: 'smhi' eller 'estimated'

### Exempel-triggers:
```json
"wind_speed > 8.0 OR wind_gust > 8.0"     // Antingen medel eller byar
"wind_gust > 15.0"                        // Endast kraftiga byar  
"(wind_gust - wind_speed) > 4.0"          // Stora skillnader
```
```

---

## üß™ Kvalitetss√§kring och Testing

### **KOMPLETT TEST-SUITE**:
```bash
# Test 1: API integration
python3 -c "from modules.weather_client import WeatherClient; client = WeatherClient({}); print('Gust support:', 'wind_gust' in client.get_current_weather())"

# Test 2: Trigger evaluation  
python3 tools/test_wind_gust_trigger.py

# Test 3: Visual rendering
python3 screenshot.py --output gust_test

# Test 4: Fallback behavior (simulera API-fel)
# Testa att estimering fungerar n√§r gust-data saknas

# Test 5: Backwards compatibility
# S√§kerst√§ll att befintlig config utan gust fortfarande fungerar
```

### **ROBUSTHET-TESTNING**:
- ‚úÖ Gust-data saknas ‚Üí Fallback till estimering
- ‚úÖ SMHI API-fel ‚Üí Graceful degradation  
- ‚úÖ Ogiltiga gust-v√§rden ‚Üí Validering och fallback
- ‚úÖ Trigger-syntax fel ‚Üí S√§ker evaluation med fallback

### **PERFORMANCE-KONTROLL**:
- Ingen betydande overhead fr√•n gust-processing
- Cache-effektiv gust-data hantering
- Minimal impact p√• befintliga moduler

---

## üìà Success Metrics

### **TEKNIK**:
- ‚úÖ Wind gust-data extraheras fr√•n SMHI  
- ‚úÖ Trigger aktiveras p√• wind_speed OR wind_gust conditions
- ‚úÖ Visning: "10.2 m/s (15)" format implementerat
- ‚úÖ Backup-kompatibel med befintlig funktionalitet
- ‚úÖ <200 rader kod per f√∂r√§ndrad fil

### **FUNKTIONALITET**:
- ‚úÖ Trigger aktiveras n√§r wind_gust > threshold √§ven om wind_speed < threshold
- ‚úÖ Visuellt tydlig presentation av b√•de medel och byar
- ‚úÖ Graceful fallback n√§r gust-data saknas
- ‚úÖ Test-system f√∂r alla gust-scenarios

### **ANV√ÑNDARV√ÑNLIGHET**:
- ‚úÖ Intuitiv visning av vindbyar-information
- ‚úÖ Bak√•tkompatibel konfiguration
- ‚úÖ Tydlig dokumentation av nya m√∂jligheter

---

## ‚ö†Ô∏è Risker och Mitigation

### **TEKNISKA RISKER**:

**RISK**: SMHI kanske inte har gust-parametrar i prognoser
- **MITIGATION**: Research-fas identifierar detta tidigt + estimering-fallback
- **PLAN B**: Anv√§nd observations-API f√∂r gust-data ist√§llet

**RISK**: Gust-data kan vara op√•litligt/spora
- **MITIGATION**: Kvalitetskontroll + graceful fallback till medelvind

**RISK**: Layout-problem med l√§ngre text  
- **MITIGATION**: Testning av extremfall + responsive layout

### **PROJEKT-RISKER**:

**RISK**: Research-fasen tar l√§ngre tid √§n planerat
- **MITIGATION**: B√∂rja med estimering-implementation medan research p√•g√•r

**RISK**: Trigger-syntax blir f√∂r komplex
- **MITIGATION**: Beh√•ll enkla OR-conditions, undvik komplexa boolean logic

---

## üöÄ Implementation Timeline

**TOTAL TIDSESTIMERING**: ~3.5 timmar

1. **Research** (30 min) ‚Üí Identifiera SMHI gust-parametrar
2. **WeatherClient** (45 min) ‚Üí API integration + parsing  
3. **Triggers** (30 min) ‚Üí Ut√∂kad trigger evaluation
4. **WindRenderer** (40 min) ‚Üí Gust display formatting
5. **Testing** (35 min) ‚Üí Komplett test-suite
6. **Documentation** (20 min) ‚Üí Config + docs update

**KRITISK V√ÑG**: Research ‚Üí WeatherClient ‚Üí Triggers
**PARALLELL**: WindRenderer och Testing kan delvis k√∂ras parallellt

---

## üìÇ Backup och Rollback Plan

### **BACKUP-STRATEGI**:
```bash
# F√∂re varje steg:
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="backup/wind_gust_[STEP]_$TIMESTAMP"
mkdir -p "$BACKUP_DIR"
cp [AFFECTED_FILES] "$BACKUP_DIR/"
```

### **ROLLBACK-SCENARIO**:
Om projektet misslyckas efter Steg 3:
```bash
# √Öterst√§ll alla filer fr√•n ORIGINAL backup
ORIGINAL_BACKUP=$(ls -td backup/ORIGINAL_* | head -1)
cp "$ORIGINAL_BACKUP"/* .
python3 tools/restart.py
echo "‚úÖ Rollback till utg√•ngsl√§ge komplett"
```

---

## üéØ Framtida Expansioner

Efter grundfunktionaliteten √§r implementerad:

### **FAS 2 - Avancerad Gust Analytics**:
- Gust-faktor ber√§kning (gust/medelvind ratio)
- Trendanalys av vindbyar √∂ver tid
- S√§songsbaserade gust-tr√∂skelv√§rden

### **FAS 3 - Meteorologisk Integration**:
- Kombination med trycktrend f√∂r storm-f√∂ruts√§gelse  
- Integration med nederb√∂rds-modulen f√∂r storm-varningar
- Temperatur-korrigerad vindkomfort

### **FAS 4 - User Experience**:
- Konfigurerbar gust-visning (ON/OFF)
- Anpassade tr√∂skelv√§rden per anv√§ndare
- Push-notifikationer vid extrema vindbyar

---

## üîÑ Chat Handoff Instructions

**VIKTIGT**: Varje steg √§r designat f√∂r att f√§rdigst√§llas i en separat chatt. H√§r √§r exakta instruktioner f√∂r hur du √∂verg√•r mellan steg.

### **STEG 1 ‚Üí STEG 2 Handoff**

**VID SLUTET AV STEG 1**, rapportera f√∂ljande:
```
‚úÖ STEG 1 F√ÑRDIGT: Research och API-discovery
üìä RESULTAT:
- SMHI gust-parameter: [DISCOVERED_NAME] (t.ex. "gust", "wg", "wind_gust_speed")
- API-struktur: [JSON_FORMAT_EXAMPLE]
- Tillg√§nglighet: [PROGNOS/OBSERVATIONS/B√ÖDE]
- Fallback-behov: [JA/NEJ + anledning]

üìÅ FILER SKAPADE:
- gust_research.md (dokumentation)
- backup/ORIGINAL_gust_research_[TIMESTAMP]/ (s√§kerhetskopia)

üéØ N√ÑSTA STEG: WeatherClient ut√∂kning
```

**PROMPT F√ñR N√ÑSTA CHATT (STEG 2)**:
```
Jag arbetar med Wind Module Gust Enhancement Project och har slutf√∂rt STEG 1 (Research). 

RESULTAT FR√ÖN STEG 1:
- SMHI gust-parameter: [S√ÑTT IN DISCOVERED_NAME]
- API-struktur: [S√ÑTT IN JSON_EXAMPLE] 
- Tillg√§nglighet: [PROGNOS/OBSERVATIONS/B√ÖDE]

Nu ska jag genomf√∂ra STEG 2: WeatherClient ut√∂kning f√∂r att extrahera gust-data fr√•n SMHI API.

M√ÖL F√ñR DENNA CHATT:
1. Backup av modules/weather_client.py
2. Ut√∂ka parse_smhi_forecast() med gust-parameter extraction
3. Uppdatera combine_weather_data() med gust-hantering och fallback
4. Testa gust-data extraction

Ge mig backup-kommando f√∂rst, sedan implementation av gust-extraction enligt projektet.
```

---

### **STEG 2 ‚Üí STEG 3 Handoff**

**VID SLUTET AV STEG 2**, rapportera f√∂ljande:
```
‚úÖ STEG 2 F√ÑRDIGT: WeatherClient ut√∂kning
üìä RESULTAT:
- Gust-extraction implementerat i parse_smhi_forecast()
- Fallback-logik: [ESTIMERING/CACHE/NONE] 
- Test-resultat: wind_speed=[X]m/s, wind_gust=[Y]m/s, source=[SOURCE]

üìÅ FILER √ÑNDRADE:
- modules/weather_client.py (backup: wind_gust_[TIMESTAMP])
- Testning genomf√∂rd och godk√§nd

‚ö†Ô∏è NOTERINGAR:
- [EVENTUELLA PROBLEM ELLER OBSERVATIONER]

üéØ N√ÑSTA STEG: Trigger-system ut√∂kning
```

**PROMPT F√ñR N√ÑSTA CHATT (STEG 3)**:
```
Wind Module Gust Enhancement Project - STEG 2 f√§rdigt.

STATUS:
- WeatherClient ger nu b√•de wind_speed och wind_gust
- Gust-parameter fr√•n SMHI: [PARAMETER_NAME]
- Fallback-strategi: [FALLBACK_METHOD]
- Test bekr√§ftat: fungerar

Nu ska jag genomf√∂ra STEG 3: Trigger-system ut√∂kning f√∂r "wind_speed > X OR wind_gust > X" logik.

M√ÖL F√ñR DENNA CHATT:
1. Backup av main_daemon.py och config.json
2. Ut√∂ka build_trigger_context() med wind_gust variabel
3. Uppdatera config.json med nya wind_trigger condition
4. Testa trigger evaluation med gust-data

Ge mig backup-kommando och implementation av trigger-ut√∂kning.
```

---

### **STEG 3 ‚Üí STEG 4 Handoff**

**VID SLUTET AV STEG 3**, rapportera f√∂ljande:
```
‚úÖ STEG 3 F√ÑRDIGT: Trigger-system ut√∂kning
üìä RESULTAT:
- wind_gust variabel tillg√§nglig i trigger context
- Ny condition: "wind_speed > 8.0 OR wind_gust > 8.0"
- Test-resultat: trigger=[TRUE/FALSE] vid test-v√§rden

üìÅ FILER √ÑNDRADE:
- main_daemon.py (backup: trigger_gust_[TIMESTAMP])
- config.json (backup: trigger_gust_[TIMESTAMP])

‚úÖ TRIGGER-TEST:
- Scenario 1: wind_speed=7, gust=10 ‚Üí trigger=[RESULT]
- Scenario 2: wind_speed=9, gust=6 ‚Üí trigger=[RESULT]

üéØ N√ÑSTA STEG: WindRenderer enhancement
```

**PROMPT F√ñR N√ÑSTA CHATT (STEG 4)**:
```
Wind Module Gust Enhancement Project - STEG 3 f√§rdigt.

STATUS:
- Trigger-system st√∂djer nu wind_gust variabel
- OR-logik fungerar: wind_speed > X OR wind_gust > X
- Testning bekr√§ftad f√∂r trigger activation

Nu ska jag genomf√∂ra STEG 4: WindRenderer enhancement f√∂r "10 m/s (15)" visningsformat.

M√ÖL F√ñR DENNA CHATT:
1. Backup av modules/renderers/wind_renderer.py
2. Implementera format_wind_speed_with_gust() metod
3. Uppdatera render() f√∂r gust-visning 
4. Testa layout och textl√§ngd

Ge mig backup-kommando och implementation av WindRenderer gust-visning.
```

---

### **STEG 4 ‚Üí STEG 5 Handoff**

**VID SLUTET AV STEG 4**, rapportera f√∂ljande:
```
‚úÖ STEG 4 F√ÑRDIGT: WindRenderer enhancement
üìä RESULTAT:
- Gust-visning format: "10.2 m/s (15)" implementerat
- Layout-testning: [FUNKAR/PROBLEM med l√§ngre text]
- Estimat-visning: "10 m/s (~14)" f√∂r estimated gust

üìÅ FILER √ÑNDRADE:
- modules/renderers/wind_renderer.py (backup: wind_renderer_gust_[TIMESTAMP])

‚úÖ VISUELL TEST:
- Normal visning: wind_speed=8.5, gust=12.3 ‚Üí "8.5 m/s (12)"
- Estimat: wind_speed=10, estimated_gust=14 ‚Üí "10.0 m/s (~14)"
- Ingen gust: wind_speed=6.5 ‚Üí "6.5 m/s"

üéØ N√ÑSTA STEG: Test-system development
```

**PROMPT F√ñR N√ÑSTA CHATT (STEG 5)**:
```
Wind Module Gust Enhancement Project - STEG 4 f√§rdigt.

STATUS:
- WindRenderer visar nu gust-data i "speed (gust)" format
- Layout fungerar f√∂r l√§ngre text
- B√•de real och estimated gust-v√§rden hanteras

Nu ska jag genomf√∂ra STEG 5: Test-system development f√∂r komplett gust-scenario testning.

M√ÖL F√ñR DENNA CHATT:
1. Skapa tools/test_wind_gust_trigger.py
2. Implementera test-scenarios f√∂r gust triggers
3. Testa trigger activation med olika gust-kombinationer
4. Verifiera visuell presentation med screenshot

Ge mig implementation av test-systemet enligt projektspecifikationen.
```

---

### **STEG 5 ‚Üí STEG 6 Handoff**

**VID SLUTET AV STEG 5**, rapportera f√∂ljande:
```
‚úÖ STEG 5 F√ÑRDIGT: Test-system development
üìä RESULTAT:
- test_wind_gust_trigger.py skapad med 3 scenarios
- Test-scenarios: gust_only, both_over, no_trigger
- Trigger-testning: [RESULTAT f√∂r varje scenario]
- Screenshot-verifiering: [VISUELLT RESULTAT]

üìÅ FILER SKAPADE:
- tools/test_wind_gust_trigger.py
- cache/test_wind_gust.json (test-data)
- screenshots/wind_gust_test.png (visuell verifiering)

‚úÖ TEST-RESULTAT:
- Scenario 1 (wind=7, gust=12): trigger=[RESULT], visning=[TEXT]
- Scenario 2 (wind=10, gust=16): trigger=[RESULT], visning=[TEXT]  
- Scenario 3 (wind=6, gust=7): trigger=[RESULT], visning=[TEXT]

üéØ N√ÑSTA STEG: Konfiguration och dokumentation
```

**PROMPT F√ñR N√ÑSTA CHATT (STEG 6)**:
```
Wind Module Gust Enhancement Project - STEG 5 f√§rdigt.

STATUS:
- Komplett test-system implementerat och verifierat
- Alla gust-scenarios testade framg√•ngsrikt
- Visuell presentation bekr√§ftad

Nu ska jag genomf√∂ra STEG 6: Final konfiguration och dokumentation.

M√ÖL F√ñR DENNA CHATT:
1. Uppdatera config.json med fullst√§ndig gust-konfiguration
2. Skapa exempel-triggers f√∂r avancerade use-cases
3. Uppdatera README/dokumentation med gust-funktionalitet
4. Slutlig verifiering av hela projektet

Ge mig implementation av final config-uppdateringar och dokumentation.
```

---

### **STEG 6 ‚Üí PROJEKT SLUTF√ñRT**

**VID SLUTET AV STEG 6**, rapportera f√∂ljande:
```
üéâ PROJEKT SLUTF√ñRT: Wind Module Gust Enhancement

üìä SLUTRESULTAT:
- ‚úÖ Dubbel trigger-logik: wind_speed > X OR wind_gust > X
- ‚úÖ Gust-visning: "10.2 m/s (15)" format
- ‚úÖ Robust fallback vid saknad gust-data
- ‚úÖ Bak√•tkompatibilitet bibeh√•llen
- ‚úÖ Komplett test-system

üìÅ FILER F√ñR√ÑNDRADE:
- modules/weather_client.py (gust extraction)
- main_daemon.py (trigger context)
- modules/renderers/wind_renderer.py (gust display)
- config.json (nya triggers)
- tools/test_wind_gust_trigger.py (test system)

üìà FUNKTIONALITETER:
- SMHI gust-parameter: [FINAL_PARAMETER_NAME]
- Trigger aktiveras vid: medelvind >8 m/s ELLER vindbyar >8 m/s
- Fallback-strategi: [FINAL_FALLBACK_METHOD]
- Test-coverage: 100% f√∂r alla gust-scenarios

üöÄ DEPLOYMENT-REDO:
Alla √§ndringar √§r implementerade, testade och dokumenterade.
Systemet √§r redo f√∂r production-anv√§ndning.

üìã BACKUP-STATUS:
Alla backup-filer sparade i backup/-katalogen f√∂r eventuell rollback.
```

---

## üìã Handoff Checklist

**F√ñR VARJE STEG-√ñVERG√ÖNG:**

### ‚úÖ Obligatoriska element i handoff:
1. **Status-sammanfattning** av genomf√∂rt steg
2. **Resultat-rapportering** med konkreta v√§rden
3. **Fil-status** (√§ndrade/skapade filer + backup-locations)
4. **Test-resultat** eller verifiering av funktionalitet
5. **Problemrapportering** om n√•got ov√§ntat intr√§ffade

### ‚úÖ Obligatoriska element i n√§sta prompt:
1. **Projektnamn** och steg-nummer
2. **Status fr√•n f√∂reg√•ende steg** (kopierat fr√•n handoff)
3. **Specifika m√•l** f√∂r aktuellt steg
4. **Tydlig f√∂rsta √•tg√§rd** (oftast backup-kommando)
5. **Referens till projektdokumentation** vid behov

### ‚úÖ S√§kerhet och kontinuitet:
- Varje steg b√∂rjar med backup
- Alla kritiska v√§rden √∂verf√∂rs mellan chattar
- Test-verifiering innan handoff
- Rollback-information vid problem

**üéØ DENNA STRUKTUR S√ÑKERST√ÑLLER**:
- Inget steg blir beroende av tidigare chat-minne
- Varje chatt har all information som beh√∂vs
- Robust felhantering och backup-strategi
- Kontinuerlig projektprogress utan informationsf√∂rlust

---

**üéñÔ∏è PROJEKTRESULTAT**: En robust, ut√∂kad Wind Module med intelligent gust-hantering som f√∂rb√§ttrar anv√§ndarens f√∂rst√•else av vindf√∂rh√•llanden f√∂r b√§ttre dagliga beslut.**